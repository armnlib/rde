#!/bin/ksh
# @Object: Echo specific RDE var or path
# @Author: S.Chamberland
# @Date:   March 2014

# Display help in xterm if user clicked on the file 
#if [[ -z $@ && $DISPLAY ]] && ! tty -s; then 
#    xterm -hold -e "$(dirname "$0")/$(basename "$0")" -h; exit 
#fi 

MYSELF=${0##*/}
DESC='Echo specific RDE var or path'
USAGE="Usage: ${MYSELF} [-h] [-l]"

usage_long() {
	 toto=$(echo -e $USAGE)
	 more 1>&2 <<EOF
$DESC

$toto

Options:
    -h, --help  : print this help
    -l, --list  : list known vars, with short match if any

EOF
}

dolist=0
namelist=""
while [[ $# -gt 0 ]] ; do
   case $1 in
      (-h|--help) usage_long; exit 0;;
      (-l|--list) dolist=1; shift ; break;;
      (--) shift ; break;;
      (-*) echo "ERROR: Option Not recognized: $1" 1>&2 ; exit 1;;
      *) namelist="$namelist $1";;
    esac
    shift
done
namelist="$namelist $@"

INCSUFFIXES=".cdk .h .hf .fh .itf90 .inc"
SRCSUFFIXES=".c .cpp .f .ftn .ptn .f90 .f95 .f03 .ftn90 .ptn90 .cdk90 .tmpl90 .F .FOR .F90 .F95 .F03"

#COMP_ARCH0=${EC_ARCH##*/}
#hostarch=-${TRUE_HOST}-${COMP_ARCH:-${COMP_ARCH0:-unknown}}
hostarch=-${BASE_ARCH}
hostarch2=-${EC_ARCH}

SRC_PATH_FILE=.exper_cour
mysrcpath0() {
   if [[ -r $SRC_PATH_FILE ]] ; then
      . ./$SRC_PATH_FILE
   fi
   echo $SRCPATH
}
mysrcpath0_recurse() {
   if [[ -r $SRC_PATH_FILE ]] ; then
      . ./$SRC_PATH_FILE
   fi
   #echo ${SRCPATH_RECURSE:-0}
   echo ${SRCPATH_RECURSE}
}
mysrcpath0_r() {
   if [[ -r $SRC_PATH_FILE ]] ; then
      . ./$SRC_PATH_FILE
   fi
   echo ${SRCPATH_R}
}

if [[ $dolist == 1 ]] ; then
   knownnames="rdeinc rdesuffix rdesuffix/inc rdesuffix/src build build/src build/pre build/obj build/mod build/lib build/bin local/src local/bin ref/src ref/bin srcpathfile srcpath srcpath_recurse srcpath_r storage"
   myname0=$(echo $namelist | cut -d' ' -f1)
   knownnames1=""
   for myname in $knownnames ; do
      myname2=$(echo $myname | sed "s|^$myname0||")
      if [[ x$myname0 == x || x$myname2 != x$myname ]] ; then
         knownnames1="$knownnames1 $myname"
      fi
   done
   echo "$knownnames1"
   exit 0
fi

for item in $namelist ; do
   case $item in
      (rdeinc)        echo $rde/include/$RDE_COMPILER_VERSION;;
      (rdesuffix)     echo $INCSUFFIXES $SRCSUFFIXES;;
      (rdesuffix/inc) echo $INCSUFFIXES;;
      (rdesuffix/src) echo $SRCSUFFIXES;;
      (build)         echo build${hostarch};;
      (build/src)     echo build${hostarch2};;
      (build/pre)     echo build${hostarch2};;
      (build/obj)     echo build${hostarch2};;
      (build/mod)     echo build${hostarch2};;
      (build/lib)     echo build${hostarch2};;
      (build/bin)     echo build${hostarch};;
      (build/run)     echo build${hostarch};;
      (local/src)     echo .;;
      (local/bin)     echo bin;;
      (ref/src)       echo ref/src;;
      (ref/bin)       echo ref/bin;;
      (srcpathfile)   echo ${SRC_PATH_FILE};;
      (srcpath)       echo $(mysrcpath0);;
      (srcpath_recurse) echo $(mysrcpath0_recurse);;
      (srcpath_r)     echo $(mysrcpath0_r);;
      (storage)       echo $(rdemodel_path -l storage);;
      (*) echo "ERROR: Unknown var name: $item" 1>&2 ; exit 1;;
    esac
done

