#!/bin/ksh
. pfbase.inc.dot

DESC='Grep (print lines matching a pattern) in src_usr and src_lib'
USAGE="USAGE: ${MYSELF} [GREP_OPTIONS] SEARCH_STRING [PATH]"
usage_long() {
	 toto=$(echo -e $USAGE)
	 more <<EOF
$DESC

$toto
EOF
}

GREP_OPTIONS=""
while [[ $# -gt 0 ]] ; do
   case $1 in
      (-h|--help) usage_long; exit 0;;
      -*) GREP_OPTIONS="$GREP_OPTIONS $1";;
      *) break;;
    esac
    shift
done

if [[ $# -lt 1 ]] ; then
   myerror "Need to provide a search string"
fi

SEARCH_STRING="$1"
shift
SEARCH_PATH=""
if [[ $# -gt 0 ]] ; then
   SEARCH_PATH="$1"
fi

if [[ -n ${SEARCH_PATH} ]] ; then
   if [[ -d ${SRC_USR}/${SEARCH_PATH} || -d ${SRC_LIB}/${SEARCH_PATH} ]] ; then
      set -x
      find -L ${SRC_USR}/${SEARCH_PATH} ${SRC_LIB}/${SEARCH_PATH} -type f -exec grep -H ${GREP_OPTIONS} "${SEARCH_STRING}" {} \;
   else
      grep -H ${GREP_OPTIONS} "${SEARCH_STRING}" ${SRC_USR}/${SEARCH_PATH} ${SRC_LIB}/${SEARCH_PATH}
   fi
else
   set -x
   find -L ${SRC_USR} ${SRC_LIB} -type f -exec grep -H ${GREP_OPTIONS} "${SEARCH_STRING}" {} \;
fi
