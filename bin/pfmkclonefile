#!/bin/ksh
# @Object: Make a clone file from a PF dev dir
# @Author: S.Chamberlands
# @Date:   June 2014
#

. .pfbase.inc.dot

##
# Help
##
DESC='Make a clone file from a PF dev dir'
USAGE="USAGE: ${MYSELF} [-h] [-v] [/PATH/TO/FILE]"
usage_long() {
	 toto=$(echo -e $USAGE)
	 more <<EOF
$DESC

$toto

Options:
    -h, --help     : print this help
    -v, --verbose  : verbose mode
    /PATH/TO/FILE  : clone file location/name
                     Default: $TMPDIR/${ATM_MODEL_NAME}_${ATM_MODEL_VERSION}_${BASE_ARCH}_${COMP_ARCH}.tar
EOF
}

## ====================================================================

##
# Inline Args
##
myforce=""
srcpath0=""
compfile=""
compverlist=""
while [[ $# -gt 0 ]] ; do
   case $1 in
      (-h|--help) usage_long; exit 0;;
      (-v|--verbose) ((verbose++));;
      (--) shift ; break ;;
      -*) myerror "Option Not recognized: $1";;
      *) break ;;
    esac
    shift
done

pf_exit_if_not_pftopdir

clonefile=$TMPDIR/${ATM_MODEL_NAME}_${ATM_MODEL_VERSION}_${BASE_ARCH}_${COMP_ARCH}.tar
if [[ $# -gt 0 ]] ; then
   clonefile="$1"
fi

if [[ x$srcpath0 != x ]] ; then
   pf_src_path_add $srcpath0
fi

mystderr 0 "++Cloning base project files"
tar cf $clonefile $PF_BASE_FILE
mystderr 0 "++Cloning reference src: $SRC_REF"
tar rf $clonefile $SRC_REF
mystderr 0 "++Cloning modified src: $SRC_USR"
mv $SRC_USR ${SRC_USR}-user
tar rf $clonefile ${SRC_USR}-user
mv ${SRC_USR}-user $SRC_USR 
mystderr 0 "++Cloning build dir ${BUILD}"
cd ${BUILD}
clonesubdirlist="src mod obj lib bin"
tar rf $clonefile $clonesubdirlist

gzip $clonefile

mystderr 0 "++Created clone file: $(ls ${clonefile}*)"
